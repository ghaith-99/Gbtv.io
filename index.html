<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مشغل قنوات البث المباشر</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: #ffffff;
        }
        .container {
            display: flex;
            height: 100vh;
        }
        .sidebar {
            width: 300px;
            background-color: #252525;
            overflow-y: auto;
            transition: all 0.3s;
        }
        .sidebar.collapsed {
            width: 60px;
        }
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        .player-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #000;
            position: relative;
        }
        #video-player {
            max-width: 100%;
            max-height: 100%;
            width: 100%;
            height: 100%;
        }
        .channel-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .channel-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #333;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
        }
        .channel-item:hover {
            background-color: #3a3a3a;
        }
        .channel-item.active {
            background-color: #0078d7;
        }
        .channel-logo {
            width: 40px;
            height: 40px;
            margin-left: 10px;
            object-fit: contain;
            background-color: #444;
            border-radius: 5px;
        }
        .channel-name {
            flex: 1;
        }
        .controls {
            display: flex;
            padding: 10px;
            background-color: #252525;
            border-top: 1px solid #333;
        }
        .toggle-sidebar {
            background-color: #333;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        .fullscreen-btn {
            background-color: #333;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
        }
        .search-box {
            padding: 10px;
            background-color: #333;
        }
        .search-input {
            width: 100%;
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #555;
            background-color: #444;
            color: white;
        }
        .category-title {
            padding: 10px 15px;
            font-weight: bold;
            background-color: #333;
            border-bottom: 1px solid #444;
        }
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
        }
        .error-message {
            color: #ff6b6b;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar" id="sidebar">
            <div class="search-box">
                <input type="text" class="search-input" id="searchInput" placeholder="ابحث عن قناة...">
            </div>
            <div id="channelGroups"></div>
        </div>
        <div class="main-content">
            <div class="player-container">
                <div class="loading" id="loading">جاري تحميل القنوات...</div>
                <video id="video-player" controls autoplay></video>
            </div>
            <div class="controls">
                <button class="toggle-sidebar" id="toggleSidebar">إخفاء القائمة</button>
                <button class="fullscreen-btn" id="fullscreenBtn">شاشة كاملة</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const videoPlayer = document.getElementById('video-player');
            const sidebar = document.getElementById('sidebar');
            const toggleSidebarBtn = document.getElementById('toggleSidebar');
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            const searchInput = document.getElementById('searchInput');
            const channelGroups = document.getElementById('channelGroups');
            const loading = document.getElementById('loading');
            
            let channels = [];
            
            // توجيه الفيديو إلى القناة المحددة
            function playChannel(url) {
                if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    videoPlayer.src = url;
                    videoPlayer.addEventListener('loadedmetadata', function() {
                        videoPlayer.play();
                    });
                } else if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(videoPlayer);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        videoPlayer.play();
                    });
                } else {
                    showError("متصفحك لا يدعم تشغيل هذا النوع من البث.");
                }
            }
            
            // عرض رسالة خطأ
            function showError(message) {
                loading.innerHTML = `<div class="error-message">${message}</div>`;
            }
            
            // تحميل القنوات من الرابط
            async function fetchChannels() {
                try {
                    const response = await fetch('https://raw.githubusercontent.com/ghaith-99/ghaith-99/refs/heads/main/mytv.json');
                    if (!response.ok) {
                        throw new Error('فشل في تحميل القنوات');
                    }
                    const data = await response.json();
                    channels = data;
                    
                    // تنظيم القنوات (كلها في مجموعة واحدة نظراً لعدم وجود تصنيف في الملف)
                    const groups = { 'القنوات': [] };
                    channels.forEach(ch => {
                        groups['القنوات'].push(ch);
                    });
                    
                    // إنشاء قائمة القنوات
                    Object.keys(groups).forEach(group => {
                        const groupElement = document.createElement('div');
                        const groupTitle = document.createElement('div');
                        groupTitle.className = 'category-title';
                        groupTitle.textContent = group;
                        groupElement.appendChild(groupTitle);
                        
                        const channelList = document.createElement('ul');
                        channelList.className = 'channel-list';
                        
                        groups[group].forEach(channel => {
                            const channelItem = document.createElement('li');
                            channelItem.className = 'channel-item';
                            channelItem.setAttribute('data-url', channel.url);
                            channelItem.setAttribute('data-name', channel.channel);
                            
                            const channelLogo = document.createElement('img');
                            channelLogo.className = 'channel-logo';
                            channelLogo.src = channel.logo || 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS10diI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjE1IiB4PSIyIiB5PSI3IiByeD0iMiIgcnk9IjIiLz48cG9seWxpbmUgcG9pbnRzPSIxNyAyIDEyIDcgNyAyIi8+PC9zdmc+';
                            channelLogo.onerror = function() {
                                this.src = 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9IiNmZmZmZmYiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBjbGFzcz0ibHVjaWRlIGx1Y2lkZS10diI+PHJlY3Qgd2lkdGg9IjIwIiBoZWlnaHQ9IjE1IiB4PSIyIiB5PSI3IiByeD0iMiIgcnk9IjIiLz48cG9seWxpbmUgcG9pbnRzPSIxNyAyIDEyIDcgNyAyIi8+PC9zdmc+';
                            };
                            
                            const channelName = document.createElement('span');
                            channelName.className = 'channel-name';
                            channelName.textContent = channel.channel;
                            
                            channelItem.appendChild(channelLogo);
                            channelItem.appendChild(channelName);
                            channelList.appendChild(channelItem);
                            
                            channelItem.addEventListener('click', function() {
                                document.querySelectorAll('.channel-item').forEach(item => {
                                    item.classList.remove('active');
                                });
                                this.classList.add('active');
                                playChannel(this.getAttribute('data-url'));
                            });
                        });
                        
                        groupElement.appendChild(channelList);
                        channelGroups.appendChild(groupElement);
                    });
                    
                    // تشغيل أول قناة
                    if (channels.length > 0) {
                        const firstChannel = document.querySelector('.channel-item');
                        if (firstChannel) {
                            firstChannel.classList.add('active');
                            playChannel(firstChannel.getAttribute('data-url'));
                        }
                    }
                    
                    // إخفاء رسالة التحميل
                    loading.style.display = 'none';
                } catch (error) {
                    showError('حدث خطأ أثناء تحميل القنوات: ' + error.message);
                }
            }
            
            // البحث عن قناة
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                document.querySelectorAll('.channel-item').forEach(item => {
                    const channelName = item.getAttribute('data-name').toLowerCase();
                    if (channelName.includes(searchTerm)) {
                        item.style.display = 'flex';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
            
            // تبديل عرض الشريط الجانبي
            toggleSidebarBtn.addEventListener('click', function() {
                sidebar.classList.toggle('collapsed');
                this.textContent = sidebar.classList.contains('collapsed') ? 'عرض القائمة' : 'إخفاء القائمة';
            });
            
            // تفعيل وضع الشاشة الكاملة
            fullscreenBtn.addEventListener('click', function() {
                if (!document.fullscreenElement) {
                    if (videoPlayer.requestFullscreen) {
                        videoPlayer.requestFullscreen();
                    } else if (videoPlayer.webkitRequestFullscreen) {
                        videoPlayer.webkitRequestFullscreen();
                    } else if (videoPlayer.msRequestFullscreen) {
                        videoPlayer.msRequestFullscreen();
                    }
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                    } else if (document.webkitExitFullscreen) {
                        document.webkitExitFullscreen();
                    } else if (document.msExitFullscreen) {
                        document.msExitFullscreen();
                    }
                }
            });
            
            // تحميل مكتبة HLS.js
            const hlsScript = document.createElement('script');
            hlsScript.src = 'https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.min.js';
            hlsScript.onload = fetchChannels;
            hlsScript.onerror = function() {
                showError('فشل في تحميل مكتبة HLS.js');
            };
            document.head.appendChild(hlsScript);
        });
    </script>
</body>
</html>
